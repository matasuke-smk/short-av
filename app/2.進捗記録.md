# DMMアフィリエイト ハイブリッド型 動画閲覧サイト - 進捗記録

## プロジェクト概要
- **プロジェクト名**: short-av.com
- **開始日**: 2025年（記録開始）
- **技術スタック**: Next.js 14, TypeScript, Supabase, Vercel

---

## Phase 1: MVP（最小実行可能製品）

### 完了項目
- [x] Next.js プロジェクト初期セットアップ
- [x] サムネイル表示の4:3縦横比固定
- [x] レイアウトの基本実装
- [x] Next.js 15のsearchParams非同期対応
- [x] ランダム表示機能の実装
- [x] iPhoneブラウザ対応レイアウト（dvh、Safe Area対応）
- [x] いいね機能完全実装（API、DB、UI）
- [x] いいね済み動画一覧ページ（/liked）
- [x] Vercelデプロイ・ドメイン連携（short-av.com）
- [x] データベース設計・構築（Supabase）
- [x] 年齢確認ゲート実装
- [x] 初回チュートリアル実装
- [x] コンプライアンス対応（広告・PR表記、景表法）
- [x] プライバシーポリシーページ作成
- [x] 利用規約ページ作成

### 進行中
- [ ] DMM API連携基盤構築
- [ ] 記事ページ（SSG）実装（目標: 10-20記事）
- [ ] 基本的なSEO設定（メタタグ、sitemap.xml）

### 未着手
- [ ] （なし）

---

## Phase 2: スワイプUI実装

### 完了項目
- [ ] スワイプUIコンポーネント実装
- [ ] 動画カード、プリロード機能
- [ ] History API連携
- [ ] セクションA⇔セクションBの相互リンク

### 進行中
- [ ] （未着手）

### 未着手
- [ ] （全て）

---

## Phase 3: 自動化・SEO強化

### 完了項目
- [ ] （未着手）

### 進行中
- [ ] （未着手）

### 未着手
- [ ] Vercel Cronによる自動更新システム
- [ ] ISR実装
- [ ] 構造化データ（VideoObject）実装
- [ ] Core Web Vitals最適化
- [ ] Google Analytics 4、Search Console連携

---

## Phase 4: 運用・改善

### 完了項目
- [ ] （未着手）

### 進行中
- [ ] （未着手）

### 未着手
- [ ] アクセス解析に基づく記事追加
- [ ] A/Bテスト（記事レイアウト、CTAボタン配置）
- [ ] パフォーマンスモニタリング
- [ ] コンバージョン率改善

---

## 技術的な課題・メモ

### 解決済み
- サムネイルの縦横比を4:3に固定（2025-10-27）
- レイアウトの微調整完了（最近のコミット）
- Next.js 15の非同期searchParams対応完了
- iPhoneブラウザでのレイアウト問題（2025-10-28）
- いいねボタンの表示問題（z-index、型エラー）（2025-10-28）
- Supabaseマイグレーションの型不一致（UUID vs TEXT）（2025-10-28）

### 現在の課題
- サムネイルクリックでの動画再生機能の動作確認が必要

### TODO（優先度高）
- データベーススキーマ設計
- DMM API連携テスト
- 年齢確認ゲートの実装
- 広告表記の追加（景表法対応）

### TODO（優先度中）
- SEOメタタグの設定
- サイトマップ生成
- プライバシーポリシー・利用規約ページ

### TODO（優先度低）
- パフォーマンス最適化
- アクセス解析設定

---

## 最近の更新履歴

### 2025-10-28（夜）
- コンプライアンス対応完了
  - トップページ上部に「広告・PR」表記を追加（景表法・ステマ規制対応）
  - プライバシーポリシーページ作成（/privacy）
  - 利用規約ページ作成（/terms）
  - フッターにポリシーページへのリンクを追加
- 年齢確認ゲート完全実装
  - 毎日初回のみ表示
  - 「広告・PR」表記付き
  - デバッグ用URL（?show_gate=1）対応
- 初回チュートリアル実装
  - 年齢確認後に自動表示
  - スワイプとタップの操作説明
  - 画面中央配置で見やすく

### 2025-10-28（朝）
- iPhoneブラウザ対応レイアウト最適化（動的ビューポート高さ、Safe Area）
- タイトル、サムネイル、バナー間の余白削除
- いいねボタン実装（サムネイル左下）
  - LocalStorageベースのユーザー識別
  - API Routes作成（/api/likes/toggle, /api/likes/my-likes）
  - Supabaseにlikesテーブル追加
  - いいね数の自動カウント機能
- いいね済み動画一覧ページ作成（/liked）
- Supabaseマイグレーション実行完了
- ドメイン設定完了（short-av.com）

### 2025-10-27
- サムネイルの4:3縦横比を確実に適用
- レイアウトの微調整
- Next.js 15のsearchParams非同期対応
- ランダム表示とレイアウト固定化を修正

---

## 参考リンク
- 要求仕様書: `app/1.要求仕様書.txt`
- Vercelダッシュボード: https://vercel.com/dashboard
- DMM API ドキュメント: （リンク）
- Supabase ダッシュボード: （リンク）

---

## メモ・アイデア
- （思いついたアイデアや改善案をここに記録）
